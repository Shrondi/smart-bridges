

<!DOCTYPE html>
<html class="writer-html5" lang="es" data-content_root="./">
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Train Report &mdash; documentación de SMART-BRIDGES - </title>
      <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=92fd9be5" />
      <link rel="stylesheet" type="text/css" href="_static/css/theme.css?v=e59714d7" />

  
      <script src="_static/jquery.js?v=5d32c60e"></script>
      <script src="_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="_static/documentation_options.js?v=e2bb6099"></script>
      <script src="_static/doctools.js?v=9a2dae69"></script>
      <script src="_static/sphinx_highlight.js?v=dc90522c"></script>
      <script src="_static/translations.js?v=efdbd0b9"></script>
    <script src="_static/js/theme.js"></script>
    <link rel="index" title="Índice" href="genindex.html" />
    <link rel="search" title="Búsqueda" href="search.html" />
    <link rel="prev" title="Estructura del repositorio" href="structure.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="index.html" class="icon icon-home">
            SMART-BRIDGES
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Buscar documentos" aria-label="Buscar documentos" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Índice de contenidos:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="introduction.html">SMART-BRIDGES</a><ul>
<li class="toctree-l2"><a class="reference internal" href="introduction.html#indice">Índice</a></li>
<li class="toctree-l2"><a class="reference internal" href="introduction.html#id1">Información del proyecto</a></li>
<li class="toctree-l2"><a class="reference internal" href="introduction.html#id2">Financiación</a></li>
<li class="toctree-l2"><a class="reference internal" href="introduction.html#id3">Licencia</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="structure.html">Estructura del repositorio</a><ul>
<li class="toctree-l2"><a class="reference internal" href="structure.html#descripcion-de-carpetas-y-archivos">Descripción de carpetas y archivos</a></li>
</ul>
</li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Train Report</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#descripcion">Descripción</a></li>
<li class="toctree-l2"><a class="reference internal" href="#requisitos">Requisitos</a></li>
<li class="toctree-l2"><a class="reference internal" href="#uso">Uso</a></li>
<li class="toctree-l2"><a class="reference internal" href="#ejemplos-de-uso">Ejemplos de uso</a></li>
<li class="toctree-l2"><a class="reference internal" href="#salida">Salida</a></li>
<li class="toctree-l2"><a class="reference internal" href="#notas-importantes">Notas importantes</a></li>
</ul>
</li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">SMART-BRIDGES</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="index.html" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active">Train Report</li>
      <li class="wy-breadcrumbs-aside">
            <a href="_sources/train-report.rst.txt" rel="nofollow"> Ver código fuente de la página</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="train-report">
<h1>Train Report<a class="headerlink" href="#train-report" title="Link to this heading"></a></h1>
<p>Generación de informes PDF a partir de ficheros CSV con los datos de los acelerómetros, agrupando lógicamente los eventos de vibración detectados para determinar qué vibraciones corresponden al paso de los trenes y su posterior resumen en un fichero de reportes.</p>
<section id="descripcion">
<h2>Descripción<a class="headerlink" href="#descripcion" title="Link to this heading"></a></h2>
<p>El script <code class="docutils literal notranslate"><span class="pre">train-report-smartbridges.py</span></code> procesa los archivos CSV de los datos en crudo para cada uno de los sensores, agrupando los eventos de trenes detectados en función de la coincidencia temporal entre sensores.</p>
<p>Una vez determinadas qué vibraciones corresponden a un tren, se genera una página en un informe PDF con gráficas de aceleración por cada eje y la transformada FFT.</p>
<p>Para una explicación más detallada del proceso, véase</p>
</section>
<section id="requisitos">
<h2>Requisitos<a class="headerlink" href="#requisitos" title="Link to this heading"></a></h2>
<ul class="simple">
<li><p>Python 3.7+</p></li>
<li><p>Librerías externas (versiones mínimas recomendadas):</p>
<ul>
<li><p><a class="reference external" href="https://matplotlib.org/">matplotlib</a> &gt;= 3.5</p></li>
<li><p><a class="reference external" href="https://numpy.org/">numpy</a> &gt;= 1.21</p></li>
<li><p><a class="reference external" href="https://pandas.pydata.org/">pandas</a> &gt;= 1.3</p></li>
<li><p><a class="reference external" href="https://seaborn.pydata.org/">seaborn</a> &gt;= 0.11</p></li>
<li><p><a class="reference external" href="https://scipy.org/">scipy</a> &gt;= 1.7</p></li>
<li><p><a class="reference external" href="https://pypdf2.readthedocs.io/">PyPDF2</a> &gt;= 2.0</p></li>
</ul>
</li>
</ul>
<section id="instalacion-de-dependencias">
<h3>Instalación de dependencias<a class="headerlink" href="#instalacion-de-dependencias" title="Link to this heading"></a></h3>
<p>Para instalar las dependencias necesarias, asegúrate de tener <cite>pip</cite> instalado y ejecuta el siguiente comando:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>pip<span class="w"> </span>install<span class="w"> </span>-r<span class="w"> </span>requirements.txt
</pre></div>
</div>
</section>
</section>
<section id="uso">
<h2>Uso<a class="headerlink" href="#uso" title="Link to this heading"></a></h2>
<p>El script se ejecuta desde la línea de comandos y requiere la ruta al directorio del puente donde se encuentran los datos de los sensores. El script buscará en la carpeta <cite>raw</cite> dentro de esa ruta los archivos CSV con los datos de aceleración.</p>
<p>Para ejecutar el script, utiliza el siguiente comando:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>python<span class="w"> </span>train-report-smartbridges.py<span class="w"> </span>--bridge_path<span class="w"> </span>/ruta/al/puente
</pre></div>
</div>
<p>El script tiene dos modos de operación:</p>
<ol class="arabic simple">
<li><p><strong>Generación de informes</strong>: Procesa los datos de los sensores y genera un informe PDF con las gráficas de aceleración y FFT.</p></li>
<li><p><strong>Regeneración de páginas específicas</strong>: Permite regenerar páginas concretas del informe en una fecha y horas específicas.</p></li>
</ol>
<section id="argumentos">
<h3>Argumentos<a class="headerlink" href="#argumentos" title="Link to this heading"></a></h3>
<p>El script <code class="docutils literal notranslate"><span class="pre">train-report-smartbridges.py</span></code> acepta los siguientes argumentos:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">--bridge_path</span></code>: Ruta a la carpeta del puente donde se encuentran los datos.</p></li>
</ul>
<p>Parámetros opcionales:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">--date</span></code> (opcional) : Fecha a procesar en formato <code class="docutils literal notranslate"><span class="pre">YYYYMMDD</span></code>. Si no se indica, usa el día anterior al día del sistema.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">--version</span></code>         : Muestra la versión del programa y termina la ejecución.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">--min_sensors</span> <span class="pre">N</span></code>   : Número mínimo de sensores para considerar un evento (por defecto: 5)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">--workers</span> <span class="pre">N</span></code>       : Número de hilos para el procesamiento paralelo (por defecto: 2 x núcleos CPU)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">--regenerar-hora</span></code>  : Una o varias horas (formato <code class="docutils literal notranslate"><span class="pre">HH:MM:SS</span></code>) para regenerar páginas concretas del informe.</p></li>
</ul>
<p>En la siguiente sección se detallan ejemplos de uso del script.</p>
</section>
</section>
<section id="ejemplos-de-uso">
<h2>Ejemplos de uso<a class="headerlink" href="#ejemplos-de-uso" title="Link to this heading"></a></h2>
<section id="creacion-de-informes">
<h3>Creación de informes<a class="headerlink" href="#creacion-de-informes" title="Link to this heading"></a></h3>
<p>Para generar el informe completo del día anterior:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>python<span class="w"> </span>train-report-smartbridges.py<span class="w"> </span>--bridge_path<span class="w"> </span>/ruta/al/puente
</pre></div>
</div>
<p>Para generar el informe especificando el número de sensores mínimos y el número de hilos:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>python<span class="w"> </span>train-report-smartbridges.py<span class="w"> </span>--bridge_path<span class="w"> </span>/ruta/al/puente<span class="w"> </span>--min_sensors<span class="w"> </span><span class="m">3</span><span class="w"> </span>--workers<span class="w"> </span><span class="m">4</span>
</pre></div>
</div>
<p>Para generar el informe de una fecha concreta (formato YYYYMMDD):</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>python<span class="w"> </span>train-report-smartbridges.py<span class="w"> </span>--bridge_path<span class="w"> </span>/ruta/al/puente<span class="w"> </span>--date<span class="w"> </span><span class="m">20240601</span>
</pre></div>
</div>
</section>
<section id="regenerar-paginas-especificas">
<h3>Regenerar páginas específicas<a class="headerlink" href="#regenerar-paginas-especificas" title="Link to this heading"></a></h3>
<p>Si necesitas regenerar la página de un tren concreto (por ejemplo, el tren detectado a las 12:34:56):</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>python<span class="w"> </span>train-report-smartbridges.py<span class="w"> </span>--bridge_path<span class="w"> </span>/ruta/al/puente<span class="w"> </span>--date<span class="w"> </span><span class="m">20240601</span><span class="w"> </span>--regenerar-hora<span class="w"> </span><span class="m">12</span>:34:56
</pre></div>
</div>
<p>Regenear varias páginas para diferentes horas:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>python<span class="w"> </span>train-report-smartbridges.py<span class="w"> </span>--bridge_path<span class="w"> </span>/ruta/al/puente<span class="w"> </span>--date<span class="w"> </span><span class="m">20240601</span><span class="w"> </span>--regenerar-hora<span class="w"> </span><span class="m">12</span>:34:56<span class="w"> </span><span class="m">13</span>:45:00
</pre></div>
</div>
<p>Para regenerar alguna página para el dia anterior, simplemente no indiques la fecha:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>python<span class="w"> </span>train-report-smartbridges.py<span class="w"> </span>--bridge_path<span class="w"> </span>/ruta/al/puente<span class="w"> </span>--regenerar-hora<span class="w"> </span><span class="m">12</span>:34:56<span class="w"> </span><span class="m">13</span>:45:00
</pre></div>
</div>
</section>
</section>
<section id="salida">
<h2>Salida<a class="headerlink" href="#salida" title="Link to this heading"></a></h2>
<p>El informe PDF se guarda en:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">/</span><span class="n">ruta</span><span class="o">/</span><span class="n">al</span><span class="o">/</span><span class="n">puente</span><span class="o">/</span><span class="n">report</span><span class="o">/&lt;</span><span class="n">año</span><span class="o">&gt;/&lt;</span><span class="n">mes</span><span class="o">&gt;/&lt;</span><span class="n">día</span><span class="o">&gt;/</span><span class="n">train_report_</span><span class="o">&lt;</span><span class="n">fecha</span><span class="o">&gt;.</span><span class="n">pdf</span>
</pre></div>
</div>
</section>
<section id="notas-importantes">
<h2>Notas importantes<a class="headerlink" href="#notas-importantes" title="Link to this heading"></a></h2>
<section id="estructura-de-los-datos">
<h3><strong>Estructura de los datos</strong><a class="headerlink" href="#estructura-de-los-datos" title="Link to this heading"></a></h3>
<p>El script espera una estructura de carpetas específica para procesar los datos:</p>
<ol class="arabic simple">
<li><p>La carpeta raíz debe contener las carpetas que representan los puentes, cada una con dos subcarpetas:</p>
<ul class="simple">
<li><p>La carpeta <cite>raw</cite> con los datos crudos de los sensores.</p></li>
<li><p>La carpeta <cite>report</cite> donde se guardan los informes generados.</p></li>
</ul>
</li>
<li><p>La carpeta <cite>raw</cite> contiene subcarpetas organizadas por año, mes (inglés en minúscula) y día, y dentro de estas, las carpetas de los sensores.</p></li>
<li><p>Dentro de las carpetas de los sensores, existe la carpeta <cite>anomalias</cite> que contiene archivos CSV con datos no válidos o irrelevantes, los cuales son ignorados por el script.</p></li>
<li><p>La carpeta <cite>report</cite> contiene subcarpetas organizadas por año, mes (inglés en minúscula) y día.</p></li>
</ol>
</section>
<section id="formato-de-los-archivos-csv">
<h3><strong>Formato de los archivos CSV</strong><a class="headerlink" href="#formato-de-los-archivos-csv" title="Link to this heading"></a></h3>
<ul class="simple">
<li><p>Cada archivo CSV que contiene los datos en crudo se denomina <cite>acceleration_HH-MM-SS.csv</cite> y es un archivo único separado por comas (<cite>,</cite>), con números en formato decimal con punto (<cite>.</cite>). Las columnas son:</p>
<ul>
<li><p><cite>timestamp</cite>: Hora de la medición</p></li>
<li><p><cite>x_accel (g)</cite>: Aceleración en el eje X (en g)</p></li>
<li><p><cite>y_accel (g)</cite>: Aceleración en el eje Y (en g)</p></li>
<li><p><cite>z_accel (g)</cite>: Aceleración en el eje Z (en g)</p></li>
</ul>
</li>
<li><p>El timestamp sigue el formato <cite>HH:mm:ss.SSS</cite> (hours:minutes:seconds.milliseconds)</p></li>
</ul>
</section>
<section id="procesamiento-de-eventos">
<h3><strong>Procesamiento de eventos</strong><a class="headerlink" href="#procesamiento-de-eventos" title="Link to this heading"></a></h3>
<ul class="simple">
<li><p>El script procesa todos los archivos CSV de aceleraciones de todas las carpetas de sensores del día correspondiente.</p></li>
<li><p>Se crean grupos disjuntos de vibraciones por timestamp (con una diferencia máxima de 2 segundos entre sensores) para determinar qué vibraciones corresponden al paso de un tren.</p></li>
<li><p>Si no se encuentran suficientes sensores para un evento (por defecto, menos de 5), ese grupo se omite y no se genera una página en el informe.</p></li>
</ul>
</section>
<section id="funcionamiento-y-salida">
<h3><strong>Funcionamiento y salida</strong><a class="headerlink" href="#funcionamiento-y-salida" title="Link to this heading"></a></h3>
<ul class="simple">
<li><p>Se generan gráficas de aceleración y transformadas FFT para cada eje (X, Y, Z) de cada tren detectado.</p></li>
<li><p>El PDF generado se guarda en la carpeta <cite>report</cite> del puente, organizada por año, mes y día. Cada página del informe corresponde a un tren detectado e incluye:
- Número de tren, fecha y hora.
- Gráficas de aceleración en los ejes X, Y y Z.
- Transformada FFT para cada eje.</p></li>
<li><p>Los archivos PDF generados se nombran con el formato <cite>train_report_&lt;fecha&gt;.pdf</cite>, donde <cite>&lt;fecha&gt;</cite> es la fecha del informe en formato <cite>YYYYMMDD</cite>.</p></li>
</ul>
</section>
<section id="cuestiones-tecnicas">
<h3><strong>Cuestiones técnicas</strong><a class="headerlink" href="#cuestiones-tecnicas" title="Link to this heading"></a></h3>
<ul class="simple">
<li><p>El script utiliza mutithreading para procesar cada carpeta de puente.</p></li>
<li><p>El script está pensando para ser gestionado por un servicio de systemd que se active diariamente y automáticamente para generar informes diarios.</p></li>
<li><p>El cálculo de la transformada FFT se realiza utilizando la función <cite>scipy.fftpack.fft</cite> para cada eje de aceleración que internamente utiliza multiprocessing.</p></li>
<li><p>Se ha aplicado un multiprocessing extra para calcular la FFT por cada sensor.</p></li>
</ul>
</section>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Pie de página">
        <a href="structure.html" class="btn btn-neutral float-left" title="Estructura del repositorio" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Anterior</a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Derechos de autor 2025, Carlos Lucena Robles - Universidad de Córdoba.</p>
  </div>

  Compilado con <a href="https://www.sphinx-doc.org/">Sphinx</a> usando un
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">tema</a>
    proporcionado por <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>